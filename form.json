{
  "$schema": "<relative path to createFormUI.schema.json>",
  "view": {
    "kind": "Form",
    "properties": {
      "isWizard": true,
      "title": "A Simple Form",
      "steps": [
        {
          "name": "basics",
          "label": "Basics",
          "elements": [
            {
              "name": "basicsDescriptionTextBlock",
              "type": "Microsoft.Common.TextBlock",
              "options": {
                "text": "This is a simple form that deploys a resource group and a storage account.",
                "link": {
                  "label": "https://github.com/glennmusa/simple-portal-form",
                  "uri": "https://github.com/glennmusa/simple-portal-form"
                }
              }
            },
            {
              "name": "armApiControls",
              "label": "",
              "type": "Microsoft.Common.Section",
              "elements": [
                {
                  "name": "subscriptionApi",
                  "type": "Microsoft.Solutions.ArmApiControl",
                  "request": {
                    "method": "GET",
                    "path": "subscriptions?api-version=2020-01-01"
                  }
                },
                {
                  "name": "storageAccountApiA",
                  "type": "Microsoft.Solutions.ArmApiControl",
                  "request": {
                    "method": "POST",
                    "path": "[concat(steps('basics').subscriptionSection.subscriptionIdA, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                    "body": {
                      "name": "[steps('basics').storageAccountSection.storageAccountNameA]",
                      "type": "Microsoft.Storage/storageAccounts"
                    }
                  }
                },
                {
                  "name": "storageAccountApiB",
                  "type": "Microsoft.Solutions.ArmApiControl",
                  "request": {
                    "method": "POST",
                    "path": "[concat(steps('basics').subscriptionSection.subscriptionIdB, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                    "body": {
                      "name": "[steps('basics').storageAccountSection.storageAccountNameB]",
                      "type": "Microsoft.Storage/storageAccounts"
                    }
                  }
                }
              ]
            },
            {
              "name": "subscriptionSection",
              "label": "Create a Storage Account in a Resource Group",
              "type": "Microsoft.Common.Section",
              "elements": [
                {
                  "name": "subscriptionIdA",
                  "label": "Subscription A",
                  "type": "Microsoft.Common.DropDown",
                  "defaultValue": "",
                  "toolTip": "Select the Subscription for your resources",
                  "multiselect": false,
                  "selectAll": false,
                  "filter": true,
                  "filterPlaceholder": "Filter items ...",
                  "multiLine": true,
                  "constraints": {
                    "allowedValues": "[map(steps('basics').armApiControls.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.subscriptionId, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                    "required": true
                  }
                },
                {
                  "name": "subscriptionIdB",
                  "label": "Subscription B",
                  "type": "Microsoft.Common.DropDown",
                  "defaultValue": "",
                  "toolTip": "Select the Subscription for your resources",
                  "multiselect": false,
                  "selectAll": false,
                  "filter": true,
                  "filterPlaceholder": "Filter items ...",
                  "multiLine": true,
                  "constraints": {
                    "allowedValues": "[map(steps('basics').armApiControls.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.subscriptionId, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                    "required": true
                  }
                }
              ]
            },
            {
              "name": "resourceGroupSection",
              "label": "Resource Group",
              "type": "Microsoft.Common.Section",
              "elements": [
                {
                  "name": "resourceGroupNameA",
                  "label": "Resource Group Name A",
                  "type": "Microsoft.Common.TextBox",
                  "defaultValue": "",
                  "toolTip": "Specify a resource group name to create",
                  "constraints": {
                    "required": true,
                    "validations": [
                      {
                        "regex": "^[-\\w\\._\\(\\)]{3,63}$",
                        "message": "The resource group name must be 3-63 alphanumeric, underscore, parentheses, hyphen, period (except at end), and Unicode characters that match the allowed characters."
                      }
                    ]
                  }
                },
                {
                  "name": "resourceGroupNameB",
                  "label": "Resource Group Name B",
                  "type": "Microsoft.Common.TextBox",
                  "defaultValue": "",
                  "toolTip": "Specify a resource group name to create",
                  "constraints": {
                    "required": true,
                    "validations": [
                      {
                        "regex": "^[-\\w\\._\\(\\)]{3,63}$",
                        "message": "The resource group name must be 3-63 alphanumeric, underscore, parentheses, hyphen, period (except at end), and Unicode characters that match the allowed characters."
                      }
                    ]
                  }
                }
              ]
            },
            {
              "name": "storageAccountSection",
              "label": "Storage Account A",
              "type": "Microsoft.Common.Section",
              "elements": [
                {
                  "name": "storageAccountNameA",
                  "label": "Storage Account Name",
                  "type": "Microsoft.Common.TextBox",
                  "defaultValue": "",
                  "toolTip": "Specify a storage account name to create",
                  "constraints": {
                    "required": true,
                    "validations": [
                      {
                        "regex": "^[a-z0-9]{3,24}$",
                        "message": "The storage account name must be between 3-24 lowercase characters and numbers."
                      },
                      {
                        "isValid": "[not(equals(steps('basics').armApiControls.storageAccountApiA.nameAvailable, false))]",
                        "message": "Storage account name currently unavailable. Please choose a different one."
                      }
                    ]
                  }
                },
                {
                  "name": "storageAccountNameB",
                  "label": "Storage Account Name",
                  "type": "Microsoft.Common.TextBox",
                  "defaultValue": "",
                  "toolTip": "Specify a storage account name to create",
                  "constraints": {
                    "required": true,
                    "validations": [
                      {
                        "regex": "^[a-z0-9]{3,24}$",
                        "message": "The storage account name must be between 3-24 lowercase characters and numbers."
                      },
                      {
                        "isValid": "[not(equals(steps('basics').armApiControls.storageAccountApiB.nameAvailable, false))]",
                        "message": "Storage account name currently unavailable. Please choose a different one."
                      }
                    ]
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    "outputs": {
      "kind": "Subscription",
      "location": "eastus",
      "subscriptionId": "[steps('basics').subscriptionSection.subscriptionIdA]",
      "parameters": {
        "location": "eastus",
        "subscriptionIdA": "[if(empty(steps('basics').subscriptionSection.subscriptionIdA), '', steps('basics').subscriptionSection.subscriptionIdA)]",
        "subscriptionIdB": "[if(empty(steps('basics').subscriptionSection.subscriptionIdB), '', steps('basics').subscriptionSection.subscriptionIdB)]",
        "resourceGroupNameA": "[if(empty(steps('basics').resourceGroupSection.resourceGroupNameA), '', steps('basics').resourceGroupSection.resourceGroupNameA)]",
        "resourceGroupNameB": "[if(empty(steps('basics').resourceGroupSection.resourceGroupNameB), '', steps('basics').resourceGroupSection.resourceGroupNameB)]",
        "storageAccountNameA": "[if(empty(steps('basics').storageAccountSection.storageAccountNameA), '', steps('basics').storageAccountSection.storageAccountNameA)]",
        "storageAccountNameB": "[if(empty(steps('basics').storageAccountSection.storageAccountNameB), '', steps('basics').storageAccountSection.storageAccountNameB)]"
      }
    }
  }
}